<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="LED Ur" />
    <title>LED Ring Digital Ur</title>

    <!-- MEGET TIDLIG: fjern weather-elementet helt på iPad / iPadOS-enheder -->
    <script>
        (function(){
            try {
                var ua = navigator.userAgent || '';
                var isIpadUA = /iPad/.test(ua);
                var isTouchMac = (navigator.platform === 'MacIntel' && navigator.maxTouchPoints && navigator.maxTouchPoints > 1);
                var isiOSish = isIpadUA || isTouchMac;

                // Hvis det er en iPad-lignende enhed fjern weather elementet tidligt
                if (isiOSish) {
                    // Sæt global markør for resten af scripts
                    window.__REMOVE_WEATHER_ON_IPAD = true;

                    // Tilføj inline style for at forhindre flash hvis element oprettes senere
                    var s = document.createElement('style');
                    s.id = 'removeWeatherEarly';
                    s.textContent = '#weatherDisplay { display: none !important; visibility: hidden !important; width:0 !important; height:0 !important; }';
                    document.head && document.head.appendChild(s);

                    // Hvis #weatherDisplay allerede findes, fjern det fullstændigt
                    try {
                        var el = document.getElementById('weatherDisplay');
                        if (el && el.parentNode) el.parentNode.removeChild(el);
                    } catch (e) {
                        // ignore
                    }

                    // Overstyr globale vejr-funktioner (ingen kald må køre)
                    window.updateWeather = function(){};
                    window.updateWeatherXHR = function(){};
                    window.updateWeatherSimple = function(){};
                    window.parseWeatherData = function(){};
                    // console.log for debugging (kan fjernes senere)
                    try { console.log('iPad detected — weather removed early'); } catch(e){}
                } else {
                    window.__REMOVE_WEATHER_ON_IPAD = false;
                }
            } catch (e) {
                window.__REMOVE_WEATHER_ON_IPAD = false;
            }
        })();
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; overflow: hidden; }

        body {
            background: #000000;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
        }

        .clock-container {
            position: relative;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
        }

        .seconds-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            -webkit-transform: rotate(-90deg);
            transform: rotate(-90deg);
        }

        .second-dot {
            position: absolute;
            border-radius: 50%;
            background: #333333;
            opacity: 0.3;
            -webkit-transition: all 0.1s ease;
            transition: all 0.1s ease;
        }

        .second-dot.active {
            background: #ff0000;
            opacity: 1;
        }

        .digital-display {
            position: absolute;
            text-align: center;
            z-index: 10;
            width: 100%;
            top: 52%;
            -webkit-transform: translateY(-50%);
            transform: translateY(-50%);
        }

        .time-display {
            font-weight: bold;
            color: #ff0000;
            font-family: 'Courier New', monospace;
        }

        .date-display {
            font-weight: bold;
            color: #ff0000;
            font-family: 'Courier New', monospace;
            opacity: 0.8;
        }

        .weather-display {
            font-weight: bold;
            color: #ff0000;
            font-family: 'Courier New', monospace;
            opacity: 0.6;
            margin-top: 10px;
        }

        /* iPad Mini (old) - Portrait mode */
        @media screen and (min-width: 768px) and (max-width: 820px) and (orientation: portrait) {
            .clock-container {
                width: 600px;
                height: 600px;
                position: absolute;
                left: 45%;
                top: 52%;
                margin-left: -550px;
                margin-top: -300px;
            }
            .time-display { font-size: 85px; letter-spacing: 10px; margin-bottom: 15px; }
            .date-display { font-size: 34px; letter-spacing: 5px; }
            .weather-display { font-size: 28px; letter-spacing: 4px; }
        }

        /* iPad (normal) - 821px+ */
        @media screen and (min-width: 821px) and (max-width: 1024px) {
            .clock-container { width: 700px; height: 700px; }
            .time-display { font-size: 110px; letter-spacing: 15px; margin-bottom: 25px; }
            .date-display { font-size: 44px; letter-spacing: 8px; }
            .weather-display { font-size: 36px; letter-spacing: 6px; }
        }

        /* iPad Pro / Desktop */
        @media screen and (min-width: 1025px) {
            .clock-container { width: 800px; height: 800px; }
            .time-display { font-size: 130px; letter-spacing: 18px; margin-bottom: 30px; }
            .date-display { font-size: 52px; letter-spacing: 10px; }
            .weather-display { font-size: 42px; letter-spacing: 8px; }
        }

        /* iPhone / small devices */
        @media screen and (max-width: 767px) {
            .clock-container { width: 350px; height: 350px; }
            .time-display { font-size: 50px; letter-spacing: 8px; margin-bottom: 15px; }
            .date-display { font-size: 20px; letter-spacing: 4px; }
            .weather-display { font-size: 16px; letter-spacing: 3px; }
        }

        /* Landscape mode - iPad Mini */
        @media (orientation: landscape) and (min-width: 768px) and (max-width: 1024px) {
            .clock-container {
                width: 650px;
                height: 650px;
                position: absolute;
                left: 45%;
                top: 50%;
                margin-left: -600px;
                margin-top: -325px;
            }
            .time-display { font-size: 125px; letter-spacing: 9px; margin-bottom: 12px; }
            .date-display { font-size: 60px; letter-spacing: 5px; }
            .weather-display { font-size: 48px; letter-spacing: 4px; }
        }

        /* Offline indicator */
        .offline-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 0, 0.9);
            color: #000;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            z-index: 1000;
            display: none;
        }

        .offline-indicator.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="offline-indicator" id="offlineIndicator">✓ OFFLINE KLAR</div>

    <div class="clock-container" id="clockContainer">
        <div class="seconds-ring" id="secondsRing"></div>

        <div class="digital-display">
            <div class="time-display" id="timeDisplay">00:00</div>
            <div class="date-display" id="dateDisplay">01-01-2024</div>
            <!-- NOTE: dette element vil blive fjernet tidligt på iPad-enheder -->
            <div class="weather-display" id="weatherDisplay">--°C</div>
        </div>
    </div>

    <script>
        // Læs global markør sat i head
        var REMOVE_WEATHER = !!window.__REMOVE_WEATHER_ON_IPAD;

        // Service worker (uændret)
        var isOldIOS = navigator.userAgent.match(/OS [5-9]_/) || navigator.userAgent.match(/OS 10_/);
        if ('serviceWorker' in navigator && !isOldIOS) {
            navigator.serviceWorker && navigator.serviceWorker.register && navigator.serviceWorker.register('sw.js').catch(function(){});
        }

        // Forsøg at fjerne weather-element hvis det stadig eksisterer (sikkerhed)
        if (REMOVE_WEATHER) {
            try {
                var w = document.getElementById('weatherDisplay');
                if (w && w.parentNode) w.parentNode.removeChild(w);
            } catch (e) {}
        }

        // Sekund-ring (bruger requestAnimationFrame for at være robust)
        function createSecondsRing() {
            var container = document.getElementById('clockContainer');
            var secondsRing = document.getElementById('secondsRing');
            requestAnimationFrame(function() {
                var rect = container.getBoundingClientRect();
                var containerSize = Math.min(rect.width || container.offsetWidth, rect.height || container.offsetHeight);
                if (!containerSize || containerSize < 10) containerSize = 700;
                var radius = containerSize * 0.475;
                var center = containerSize / 2;
                var dotSize = Math.max(6, containerSize * 0.018);
                secondsRing.innerHTML = '';
                for (var i = 0; i < 60; i++) {
                    var dot = document.createElement('div');
                    dot.className = 'second-dot';
                    dot.id = 'second-' + i;
                    var angle = (i * 360 / 60) * Math.PI / 180;
                    var x = Math.cos(angle) * radius + center;
                    var y = Math.sin(angle) * radius + center;
                    dot.style.width = dotSize + 'px';
                    dot.style.height = dotSize + 'px';
                    dot.style.left = (x - dotSize / 2) + 'px';
                    dot.style.top = (y - dotSize / 2) + 'px';
                    secondsRing.appendChild(dot);
                }
            });
        }

        function pad(n) { return n < 10 ? '0' + n : '' + n; }

        function updateClock() {
            var now = new Date();
            document.getElementById('timeDisplay').textContent = pad(now.getHours()) + ':' + pad(now.getMinutes());
            document.getElementById('dateDisplay').textContent = pad(now.getDate()) + '-' + pad(now.getMonth() + 1) + '-' + now.getFullYear();
            var sec = now.getSeconds();
            for (var i = 0; i < 60; i++) {
                var d = document.getElementById('second-' + i);
                if (!d) continue;
                d.className = (i <= sec) ? 'second-dot active' : 'second-dot';
            }
        }

        // Weather-funktioner: deaktiveret hvis REMOVE_WEATHER er sand
        function parseWeatherData() { if (REMOVE_WEATHER) return; /* ellers normalt */ }
        function updateWeatherXHR() { if (REMOVE_WEATHER) return; /* ellers normalt */ }
        function updateWeather() { if (REMOVE_WEATHER) return; /* ellers normalt */ }

        // Init
        function init() {
            createSecondsRing();
            updateClock();
            setInterval(updateClock, 1000);

            if (!REMOVE_WEATHER) {
                try { updateWeather(); setInterval(updateWeather, 600000); } catch (e) {}
            }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init, false);
        } else {
            init();
        }

        // Resize debounce
        var _t;
        window.addEventListener('resize', function() {
            clearTimeout(_t);
            _t = setTimeout(function() {
                createSecondsRing();
                updateClock();
                if (REMOVE_WEATHER) {
                    var w = document.getElementById('weatherDisplay');
                    if (w && w.parentNode) w.parentNode.removeChild(w);
                }
            }, 200);
        });
    </script>
</body>
</html>
